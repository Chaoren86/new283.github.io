import{l as a,m as e,G as t,J as l,N as n,s as o,a as s,w as i,j as c,o as d,b as u,f as h,v as p,e as r,g as f,h as _,i as m,D as v,I as g,C as b,K as w}from"./index-2i5NzYaS.js";import{$ as y}from"./request.CmV1KS_Y.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const k=x({data:()=>({isPhone:!0,formData:{phone:null,code:null},wxData:{openid:null,nickname:null,headimgurl:null,agent_code:null},count:null,timer:null,agent_code:a("agent_code")||"",login_loading:!1,captcha:null,captchaButton:null,isWechatBrowser:!0,showModal:!0}),mounted(){this.captchaButton=document.getElementById("captcha-button"),window.initAliyunCaptcha({SceneId:"bv3tympas",prefix:"14sny91",mode:"popup",element:"#captcha-element",button:"#captcha-button",captchaVerifyCallback:this.captchaVerifyCallback,onBizResultCallback:this.onBizResultCallback,getInstance:this.getInstance,slideStyle:{width:360,height:40},language:"cn"})},beforeUnmount(){var a,e;this.captchaButton=null,null==(a=document.getElementById("aliyunCaptcha-mask"))||a.remove(),null==(e=document.getElementById("aliyunCaptcha-window-popup"))||e.remove()},methods:{openMsg(){this.showModal=!0},closeModal(){this.showModal=!1},checkPhone(){this.isMobile(this.formData.phone)?this.isPhone=!1:this.isPhone=!0},getInstance(a){this.captcha=a,console.log(this.captcha)},async captchaVerifyCallback(a){const t=await y.post("/aliyunVerify",{captchaVerifyParam:a,phone:this.formData.phone});return 200==t.code&&"T001"==t.data?{captchaResult:!0,bizResult:!0}:e({title:t.msg,duration:1e3,icon:"none"})},onBizResultCallback(a){a&&this.getPhoneCode()},popup(a){this.popupId=a,this.captchaButton.click()},getPhoneCode(){this.timer||(this.showCode=!0,this.count=60,this.timer=setInterval((()=>{this.count>0&&this.count<=60?this.count--:(this.showCode=!1,clearInterval(this.timer),this.timer=null)}),1e3))},getMessage(){if(!this.isMobile(this.formData.phone))return e({title:"手机号码输入有误",duration:1e3,icon:"none",position:"top"});t({mask:!0}),y.post("/app_user_get_message",{phone:this.formData.phone,type:"sign"}).then((a=>(l(),200==a.code&&"短信发送成功"==a.msg?(this.getPhoneCode(),e({title:a.msg,duration:3e3,icon:"none",position:"top"})):e({title:a.msg,duration:1e3,icon:"none",position:"top"}))))},isMobile:a=>/^1[3-9]\d{9}$/.test(a),routerIndex(){n({url:"/pages/index/index"})},toIm(){n({url:"/pages/im/imdetails"})},phoneLogin(){for(let a in this.formData)if(!this.formData[a])return e({title:"手机号或验证码不能为空",duration:1e3,icon:"none"});if(this.login_loading=!0,!this.isMobile(this.formData.phone))return this.login_loading=!1,e({title:"手机号码有误",duration:1e3,icon:"none"});y.post("/app_user_phone_bind",{type:"login",phone:this.formData.phone,code:this.formData.code,agent_code:this.agent_code}).then((a=>200==a.code?(this.show=!0,this.UserInfo=a.data,o("UserInfo",a.data),e({title:a.msg,duration:1e3,icon:"none"}),n({url:"/pages/index/index"})):(this.login_loading=!1,e({title:a.msg,duration:1e3,icon:"none"}))))}}},[["render",function(a,e,t,l,n,o){const y=c,x=m,k=v,C=g,I=b,D=w;return d(),s(y,{class:"login"},{default:i((()=>[u(y,{class:"foot-action head-fixed child-view"},{default:i((()=>[u(y,{class:"w-750 title",style:{position:"fixed",top:"0",left:"0","z-index":"999"}},{default:i((()=>[u(y,{class:"h-100 w-row-justify-between-align"},{default:i((()=>[u(y,{class:"wh-80 w-row-center"}),u(y,{class:"w-350 h-100 w-row-center w-wz-conts font-36"},{default:i((()=>[u(x,null,{default:i((()=>[h("绑定手机号")])),_:1})])),_:1}),u(y,{class:"wh-80 w-row-center"})])),_:1})])),_:1}),u(y,{class:"bwh-120"}),u(y,{class:"cover-tw index-bg absolute-default fixed"}),u(y,{class:"content-box padding-top-xs"},{default:i((()=>[u(D,{class:"van-form login"},{default:i((()=>[u(y,{class:"van-cell-group van-cell-group--inset"},{default:i((()=>[u(y,{class:"van-cell van-field van-field--label-top"},{default:i((()=>[u(y,{class:"van-cell__title van-field__label van-field__label--top"},{default:i((()=>[u(k,{for:"van-field-7-input"},{default:i((()=>[h("手机号")])),_:1})])),_:1}),u(y,{class:"van-cell__value van-field__value"},{default:i((()=>[u(y,{class:"van-field__body"},{default:i((()=>[u(C,{type:"text",id:"van-field-7-input",modelValue:n.formData.phone,"onUpdate:modelValue":e[0]||(e[0]=a=>n.formData.phone=a),name:"username",onInput:o.checkPhone,class:"van-field__control",placeholder:"请填写手机号",maxlength:11,"aria-labelledby":"van-field-7-label"},null,8,["modelValue","onInput"]),u(y,{class:"van-field__button"},{default:i((()=>[u(I,{type:"button",class:"van-button van-button--warning van-button--small",disabled:n.isPhone,id:"captcha-button"},{default:i((()=>[p("div",{class:"van-button__content"},[n.count?(d(),r("span",{key:0,class:"van-button__text"},"重新获取"+f(n.count<10?"0"+n.count:n.count)+"秒",1)):(d(),r("span",{key:1,class:"van-button__text"},"发送验证码"))])])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),u(y,{class:"van-cell-group van-cell-group--inset"},{default:i((()=>[u(y,{class:"van-cell van-field van-field--label-top"},{default:i((()=>[u(y,{class:"van-cell__title van-field__label van-field__label--top"},{default:i((()=>[u(k,{for:"van-field-7-input"},{default:i((()=>[h("验证码")])),_:1})])),_:1}),u(y,{class:"van-cell__value van-field__value"},{default:i((()=>[u(y,{class:"van-field__body"},{default:i((()=>[u(C,{type:"text",id:"van-field-7-input",modelValue:n.formData.code,"onUpdate:modelValue":e[1]||(e[1]=a=>n.formData.code=a),name:"username",class:"van-field__control",placeholder:"请填写验证码","aria-labelledby":"van-field-7-label"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),u(y,{class:"padding"},{default:i((()=>[u(I,{type:"submit",class:"van-button van-button--primary van-button--normal van-button--block",onClick:o.phoneLogin,disabled:n.login_loading},{default:i((()=>[p("div",{class:"van-button__content"},[p("span",{class:"van-button__text"},"立即绑定")])])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1}),n.showModal?(d(),s(y,{key:0,class:"custom-modal"},{default:i((()=>[u(y,{class:"modal-mask",onClick:o.closeModal},null,8,["onClick"]),u(y,{class:"modal-container"},{default:i((()=>[u(y,{class:"modal-header"},{default:i((()=>[u(x,{class:"modal-title"},{default:i((()=>[h("温馨提示")])),_:1})])),_:1}),u(y,{class:"modal-content"},{default:i((()=>[u(x,{class:"modal-text"},{default:i((()=>[h("尊敬的会员您好，微信首次登录需绑定手机号码作为主账号，请您务必完成绑定。")])),_:1})])),_:1}),u(y,{class:"modal-footer"},{default:i((()=>[u(I,{class:"confirm-btn",onClick:o.closeModal},{default:i((()=>[h("确定")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):_("",!0),p("div",{id:"captcha-element"})])),_:1})}],["__scopeId","data-v-045a66e6"]]);export{k as default};
