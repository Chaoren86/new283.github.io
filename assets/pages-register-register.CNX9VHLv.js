import{l as e,k as t,m as a,s as n,N as l,G as i,J as o,a as s,w as c,j as d,o as r,b as u,f as h,v as p,e as g,g as _,x as f,i as v,D as m,I as b,C as w,K as D}from"./index-CzPo0QPm.js";import{$ as x}from"./request.BhjEuznL.js";import{_ as y}from"./goBack-icon.Dnnb51to.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=k({data:()=>({openRegister:!1,openLogin:!1,isPhone:!0,loginData:{account:null,password:null},registerData:{account:null,phone:null,code:null,password:null,password2:null},formData:{phone:null,code:null},wxData:{openid:null,nickname:null,headimgurl:null,agent_code:null},count:null,timer:null,agent_code:e("agent_code")||"",login_loading:!1,captcha:null,captchaButton:null,isWechatBrowser:!0,openPhone:!1,config:null,isPhone2:!0}),onLoad(e){this.getConfig(),e.openid&&(this.wxData.openid=e.openid,this.wxData.nickname=e.nickname,this.wxData.headimgurl=e.headimgurl,this.loginWithWechat())},mounted(){this.isWechatBrowser=this.checkIsWechatBrowser(),this.captchaButton=document.getElementById("captcha-button"),window.initAliyunCaptcha({SceneId:"bv3tympas",prefix:"14sny91",mode:"popup",element:"#captcha-element",button:"#captcha-button",captchaVerifyCallback:this.captchaVerifyCallback,onBizResultCallback:this.onBizResultCallback,getInstance:this.getInstance,slideStyle:{width:360,height:40},language:"cn"})},beforeUnmount(){var e,t;this.captchaButton=null,null==(e=document.getElementById("aliyunCaptcha-mask"))||e.remove(),null==(t=document.getElementById("aliyunCaptcha-window-popup"))||t.remove()},methods:{checkPhone(){this.formData.phone&&this.formData.phone.length>11&&(this.formData.phone=this.formData.phone.substring(0,11)),this.isMobile(this.formData.phone)?this.isPhone=!1:this.isPhone=!0},checkPhone2(){this.registerData.phone&&this.registerData.phone.length>11&&(this.registerData.phone=this.registerData.phone.substring(0,11)),this.isMobile(this.registerData.phone)?this.isPhone2=!1:this.isPhone2=!0},toLogin(){t({url:"/pages/login/login?is_login=1"})},toRegister(){this.openRegister=!0,this.openLogin=!1,this.openPhone=!1},toPhoneLogin(){this.openPhone=!0,this.openLogin=!1,this.openRegister=!1},accountLogin(){if(!this.loginData.account||!this.loginData.password)return a({title:"账号和密码不能为空",duration:1e3,icon:"none"});this.login_loading=!0,x.post("/app_user_account_login",{account:this.loginData.account,password:this.loginData.password,agent_code:this.agent_code}).then((e=>{this.login_loading=!1,200==e.code?(n("UserInfo",e.data),a({title:e.msg,icon:"success"}),setTimeout((()=>{l({url:"/pages/index/index"})}),1e3)):a({title:e.msg,icon:"none"})})).catch((e=>{this.login_loading=!1,a({title:"登录失败，请重试",icon:"none"})}))},isValidAccount:e=>/^[a-zA-Z0-9]+$/.test(e),register(){return this.registerData.account&&this.registerData.phone&&this.registerData.code&&this.registerData.password&&this.registerData.password2?this.isValidAccount(this.registerData.account)?this.isMobile(this.registerData.phone)?this.registerData.password!==this.registerData.password2?a({title:"两次密码输入不一致",duration:1e3,icon:"none"}):(this.login_loading=!0,void x.post("/app_user_register",{account:this.registerData.account,phone:this.registerData.phone,code:this.registerData.code,password:this.registerData.password,agent_code:this.agent_code}).then((e=>{if(this.login_loading=!1,200==e.code)return n("UserInfo",e.data),a({title:e.msg,duration:1e3,icon:"none"}),l({url:"/pages/index/index"});a({title:e.msg,icon:"none"})})).catch((e=>{this.login_loading=!1,a({title:"注册失败，请重试",icon:"none"})}))):a({title:"手机号码格式错误",duration:1e3,icon:"none"}):a({title:"账号只能包含字母和数字",duration:1e3,icon:"none"}):a({title:"请填写完整信息",duration:1e3,icon:"none"})},oneKeyPhoneLogin(){this.openPhone=!0},getConfig(){x.post("/app_user_get_config").then((e=>{var t,a,n,l;200==e.code&&(this.config=e.data,console.log(null==(t=this.config)?void 0:t.wx_login_open,"wx_login_open"),this.openLogin=!0,this.openPhone=!1,this.openRegister=!1,this.isWechatBrowser&&1==(null==(a=this.config)?void 0:a.wx_login_open)&&(this.openLogin=!1,this.openPhone=!1),this.isWechatBrowser&&0!=(null==(n=this.config)?void 0:n.wx_login_open)||(this.openPhone=!0,this.openLogin=!1),this.isWechatBrowser&&1!=(null==(l=this.config)?void 0:l.paw_login_open)||(this.openPhone=!1,this.openLogin=!0))}))},checkIsWechatBrowser:()=>navigator.userAgent.toLowerCase().includes("micromessenger"),wechatLogin(){if(this.config.app_weixing_url){const e=encodeURIComponent(`${window.location.origin}/#/pages/login/login`);window.location.href=this.config.app_weixing_url+`/wx_go.php?action=get_code&backurl=${e}`}else a({title:"未配置微信授权接口，请联系管理员",icon:"error"})},async loginWithWechat(){i({title:"登录中..."});try{this.wxData.agent_code=this.agent_code;const e=await x.post("/app_user_weixin_login",this.wxData);o(),200==e.code?(n("UserInfo",e.data),a({title:e.msg,icon:"success"}),e.data.phone?setTimeout((()=>{l({url:"/pages/index/index"})}),1e3):l({url:"/pages/my/mobile"})):a({title:e.msg,icon:"none"})}catch(e){o(),a({title:"登录失败，请重试",icon:"none"})}},async captchaVerifyCallback(e){const t=await x.post("/aliyunVerify",{captchaVerifyParam:e,phone:this.registerData.phone});return 200==t.code&&"T001"==t.data?{captchaResult:!0,bizResult:!0}:a({title:t.msg,duration:1e3,icon:"none"})},onBizResultCallback(e){e&&this.getPhoneCode()},popup(e){this.popupId=e,this.captchaButton.click()},getPhoneCode(){this.timer||(this.showCode=!0,this.count=60,this.timer=setInterval((()=>{this.count>0&&this.count<=60?this.count--:(this.showCode=!1,clearInterval(this.timer),this.timer=null)}),1e3))},getMessage(){if(!this.isMobile(this.formData.phone))return a({title:"手机号码输入有误",duration:1e3,icon:"none",position:"top"});i({mask:!0}),x.post("/app_user_get_message",{phone:this.formData.phone,type:"sign"}).then((e=>(o(),200==e.code&&"短信发送成功"==e.msg?(this.getPhoneCode(),a({title:e.msg,duration:3e3,icon:"none",position:"top"})):a({title:e.msg,duration:1e3,icon:"none",position:"top"}))))},isMobile:e=>/^1[3-9]\d{9}$/.test(e),routerIndex(){l({url:"/pages/index/index"})},toIm(){l({url:"/pages/im/imdetails"})},phoneLogin(){for(let e in this.formData)if(!this.formData[e])return a({title:"手机号或验证码不能为空",duration:1e3,icon:"none"});if(this.login_loading=!0,!this.isMobile(this.formData.phone))return this.login_loading=!1,a({title:"手机号码有误",duration:1e3,icon:"none"});x.post("/app_user_phone_login",{type:"login",phone:this.formData.phone,code:this.formData.code,agent_code:this.agent_code}).then((e=>200==e.code?(this.show=!0,this.UserInfo=e.data,n("UserInfo",e.data),a({title:e.msg,duration:1e3,icon:"none"}),l({url:"/pages/index/index"})):(this.login_loading=!1,a({title:e.msg,duration:1e3,icon:"none"}))))}}},[["render",function(e,t,a,n,l,i){const o=f,x=d,k=v,I=m,P=b,C=w,V=D;return r(),s(x,{class:"login"},{default:c((()=>[u(x,{class:"foot-action head-fixed child-view"},{default:c((()=>[u(x,{class:"w-750 title",style:{position:"fixed",top:"0",left:"0","z-index":"999"}},{default:c((()=>[u(x,{class:"h-100 w-row-justify-between-align"},{default:c((()=>[u(x,{class:"wh-80 w-row-center",onClick:t[0]||(t[0]=e=>i.routerIndex())},{default:c((()=>[u(o,{class:"wh-40",src:y})])),_:1}),u(x,{class:"w-350 h-100 w-row-center w-wz-conts font-36"},{default:c((()=>[u(k,null,{default:c((()=>[h("账号注册")])),_:1})])),_:1}),u(x,{class:"wh-80 w-row-center"})])),_:1})])),_:1}),u(x,{class:"bwh-120"}),u(x,{class:"cover-tw index-bg absolute-default fixed"}),u(x,{class:"content-box padding-top-xs",style:{"margin-top":"50rpx"}},{default:c((()=>[u(x,{class:"text-lg text-bold text-color-black",style:{padding:"0 60rpx",display:"flex","justify-content":"space-between","align-items":"center"}},{default:c((()=>[h("账密注册 "),p("span",{onClick:t[1]||(t[1]=e=>i.toLogin()),class:"goRegister"},"去登录")])),_:1}),u(V,{class:"van-form login"},{default:c((()=>[u(x,{class:"van-cell-group van-cell-group--inset"},{default:c((()=>[u(x,{class:"van-cell van-field van-field--label-top"},{default:c((()=>[u(x,{class:"van-cell__title van-field__label van-field__label--top"},{default:c((()=>[u(I,{for:"van-field-7-input"},{default:c((()=>[h("账号名")])),_:1})])),_:1}),u(x,{class:"van-cell__value van-field__value"},{default:c((()=>[u(x,{class:"van-field__body"},{default:c((()=>[u(P,{type:"text",id:"van-field-7-input",modelValue:l.registerData.account,"onUpdate:modelValue":t[2]||(t[2]=e=>l.registerData.account=e),name:"username",class:"van-field__control",placeholder:"请输入账号名","aria-labelledby":"van-field-7-label"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),u(x,{class:"van-cell-group van-cell-group--inset"},{default:c((()=>[u(x,{class:"van-cell van-field van-field--label-top"},{default:c((()=>[u(x,{class:"van-cell__title van-field__label van-field__label--top"},{default:c((()=>[u(I,{for:"van-field-7-input"},{default:c((()=>[h("手机号")])),_:1})])),_:1}),u(x,{class:"van-cell__value van-field__value"},{default:c((()=>[u(x,{class:"van-field__body"},{default:c((()=>[u(P,{type:"text",id:"van-field-7-input",modelValue:l.registerData.phone,"onUpdate:modelValue":t[3]||(t[3]=e=>l.registerData.phone=e),name:"username",class:"van-field__control",placeholder:"请填写手机号","aria-labelledby":"van-field-7-label",maxlength:11,onInput:i.checkPhone2},null,8,["modelValue","onInput"]),u(x,{class:"van-field__button"},{default:c((()=>[u(C,{type:"button",class:"van-button van-button--warning van-button--small",disabled:l.isPhone2,id:"captcha-button"},{default:c((()=>[p("div",{class:"van-button__content"},[l.count?(r(),g("span",{key:0,class:"van-button__text"},"重新获取"+_(l.count<10?"0"+l.count:l.count)+"秒",1)):(r(),g("span",{key:1,class:"van-button__text"},"发送验证码"))])])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),u(x,{class:"van-cell-group van-cell-group--inset"},{default:c((()=>[u(x,{class:"van-cell van-field van-field--label-top"},{default:c((()=>[u(x,{class:"van-cell__title van-field__label van-field__label--top"},{default:c((()=>[u(I,{for:"van-field-7-input"},{default:c((()=>[h("短信验证码")])),_:1})])),_:1}),u(x,{class:"van-cell__value van-field__value"},{default:c((()=>[u(x,{class:"van-field__body"},{default:c((()=>[u(P,{type:"text",id:"van-field-7-input",modelValue:l.registerData.code,"onUpdate:modelValue":t[4]||(t[4]=e=>l.registerData.code=e),name:"username",class:"van-field__control",placeholder:"请填写短信验证码","aria-labelledby":"van-field-7-label"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),u(x,{class:"van-cell-group van-cell-group--inset"},{default:c((()=>[u(x,{class:"van-cell van-field van-field--label-top"},{default:c((()=>[u(x,{class:"van-cell__title van-field__label van-field__label--top"},{default:c((()=>[u(I,{for:"van-field-7-input"},{default:c((()=>[h("登录密码")])),_:1})])),_:1}),u(x,{class:"van-cell__value van-field__value"},{default:c((()=>[u(x,{class:"van-field__body"},{default:c((()=>[u(P,{type:"password",id:"van-field-7-input",modelValue:l.registerData.password,"onUpdate:modelValue":t[5]||(t[5]=e=>l.registerData.password=e),name:"username",class:"van-field__control",placeholder:"请输入登录密码","aria-labelledby":"van-field-7-label"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),u(x,{class:"van-cell-group van-cell-group--inset"},{default:c((()=>[u(x,{class:"van-cell van-field van-field--label-top"},{default:c((()=>[u(x,{class:"van-cell__title van-field__label van-field__label--top"},{default:c((()=>[u(I,{for:"van-field-7-input"},{default:c((()=>[h("确认密码")])),_:1})])),_:1}),u(x,{class:"van-cell__value van-field__value"},{default:c((()=>[u(x,{class:"van-field__body"},{default:c((()=>[u(P,{type:"password",id:"van-field-7-input",modelValue:l.registerData.password2,"onUpdate:modelValue":t[6]||(t[6]=e=>l.registerData.password2=e),name:"username",class:"van-field__control",placeholder:"再次请输入登录密码","aria-labelledby":"van-field-7-label"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),u(x,{class:"padding"},{default:c((()=>[u(C,{type:"submit",class:"van-button van-button--primary van-button--normal van-button--block",onClick:i.register,disabled:l.login_loading},{default:c((()=>[p("div",{class:"van-button__content"},[p("span",{class:"van-button__text"},"立即注册")])])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1}),p("div",{id:"captcha-element"})])),_:1})}],["__scopeId","data-v-cdeb58fa"]]);export{I as default};
