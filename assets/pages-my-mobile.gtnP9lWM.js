import{_ as a,l as e,m as t,H as l,K as n,N as o,s,a as i,w as c,j as d,o as u,b as h,f as p,x as r,e as f,g as _,h as m,i as g,E as v,I as b,D as w,L as y}from"./index-BrfRr25j.js";import{$ as x}from"./request.BcI2bJcs.js";const k=a({data:()=>({isPhone:!0,formData:{phone:null,code:null},wxData:{openid:null,nickname:null,headimgurl:null,agent_code:null},count:null,timer:null,agent_code:e("agent_code")||"",login_loading:!1,captcha:null,captchaButton:null,isWechatBrowser:!0,showModal:!0}),mounted(){this.captchaButton=document.getElementById("captcha-button"),window.initAliyunCaptcha({SceneId:"bv3tympas",prefix:"14sny91",mode:"popup",element:"#captcha-element",button:"#captcha-button",captchaVerifyCallback:this.captchaVerifyCallback,onBizResultCallback:this.onBizResultCallback,getInstance:this.getInstance,slideStyle:{width:360,height:40},language:"cn"})},beforeUnmount(){var a,e;this.captchaButton=null,null==(a=document.getElementById("aliyunCaptcha-mask"))||a.remove(),null==(e=document.getElementById("aliyunCaptcha-window-popup"))||e.remove()},methods:{openMsg(){this.showModal=!0},closeModal(){this.showModal=!1},checkPhone(){this.isMobile(this.formData.phone)?this.isPhone=!1:this.isPhone=!0},getInstance(a){this.captcha=a,console.log(this.captcha)},async captchaVerifyCallback(a){const e=await x.post("/aliyunVerify",{captchaVerifyParam:a,phone:this.formData.phone});return 200==e.code&&"T001"==e.data?{captchaResult:!0,bizResult:!0}:t({title:e.msg,duration:1e3,icon:"none"})},onBizResultCallback(a){a&&this.getPhoneCode()},popup(a){this.popupId=a,this.captchaButton.click()},getPhoneCode(){this.timer||(this.showCode=!0,this.count=60,this.timer=setInterval((()=>{this.count>0&&this.count<=60?this.count--:(this.showCode=!1,clearInterval(this.timer),this.timer=null)}),1e3))},getMessage(){if(!this.isMobile(this.formData.phone))return t({title:"手机号码输入有误",duration:1e3,icon:"none",position:"top"});l({mask:!0}),x.post("/app_user_get_message",{phone:this.formData.phone,type:"sign"}).then((a=>(n(),200==a.code&&"短信发送成功"==a.msg?(this.getPhoneCode(),t({title:a.msg,duration:3e3,icon:"none",position:"top"})):t({title:a.msg,duration:1e3,icon:"none",position:"top"}))))},isMobile:a=>/^1[3-9]\d{9}$/.test(a),routerIndex(){o({url:"/pages/index/index"})},toIm(){o({url:"/pages/im/imdetails"})},phoneLogin(){for(let a in this.formData)if(!this.formData[a])return t({title:"手机号或验证码不能为空",duration:1e3,icon:"none"});if(this.login_loading=!0,!this.isMobile(this.formData.phone))return this.login_loading=!1,t({title:"手机号码有误",duration:1e3,icon:"none"});x.post("/app_user_phone_bind",{type:"login",phone:this.formData.phone,code:this.formData.code,agent_code:this.agent_code}).then((a=>200==a.code?(this.show=!0,this.UserInfo=a.data,s("UserInfo",a.data),t({title:a.msg,duration:1e3,icon:"none"}),o({url:"/pages/index/index"})):(this.login_loading=!1,t({title:a.msg,duration:1e3,icon:"none"}))))}}},[["render",function(a,e,t,l,n,o){const s=d,x=g,k=v,C=b,I=w,D=y;return u(),i(s,{class:"login"},{default:c((()=>[h(s,{class:"foot-action head-fixed child-view"},{default:c((()=>[h(s,{class:"w-750 title",style:{position:"fixed",top:"0",left:"0","z-index":"999"}},{default:c((()=>[h(s,{class:"h-100 w-row-justify-between-align"},{default:c((()=>[h(s,{class:"wh-80 w-row-center"}),h(s,{class:"w-350 h-100 w-row-center w-wz-conts font-36"},{default:c((()=>[h(x,null,{default:c((()=>[p("绑定手机号")])),_:1})])),_:1}),h(s,{class:"wh-80 w-row-center"})])),_:1})])),_:1}),h(s,{class:"bwh-120"}),h(s,{class:"cover-tw index-bg absolute-default fixed"}),h(s,{class:"content-box padding-top-xs"},{default:c((()=>[h(D,{class:"van-form login"},{default:c((()=>[h(s,{class:"van-cell-group van-cell-group--inset"},{default:c((()=>[h(s,{class:"van-cell van-field van-field--label-top"},{default:c((()=>[h(s,{class:"van-cell__title van-field__label van-field__label--top"},{default:c((()=>[h(k,{for:"van-field-7-input"},{default:c((()=>[p("手机号")])),_:1})])),_:1}),h(s,{class:"van-cell__value van-field__value"},{default:c((()=>[h(s,{class:"van-field__body"},{default:c((()=>[h(C,{type:"text",id:"van-field-7-input",modelValue:n.formData.phone,"onUpdate:modelValue":e[0]||(e[0]=a=>n.formData.phone=a),name:"username",onInput:o.checkPhone,class:"van-field__control",placeholder:"请填写手机号",maxlength:11,"aria-labelledby":"van-field-7-label"},null,8,["modelValue","onInput"]),h(s,{class:"van-field__button"},{default:c((()=>[h(I,{type:"button",class:"van-button van-button--warning van-button--small",disabled:n.isPhone,id:"captcha-button"},{default:c((()=>[r("div",{class:"van-button__content"},[n.count?(u(),f("span",{key:0,class:"van-button__text"},"重新获取"+_(n.count<10?"0"+n.count:n.count)+"秒",1)):(u(),f("span",{key:1,class:"van-button__text"},"发送验证码"))])])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),h(s,{class:"van-cell-group van-cell-group--inset"},{default:c((()=>[h(s,{class:"van-cell van-field van-field--label-top"},{default:c((()=>[h(s,{class:"van-cell__title van-field__label van-field__label--top"},{default:c((()=>[h(k,{for:"van-field-7-input"},{default:c((()=>[p("验证码")])),_:1})])),_:1}),h(s,{class:"van-cell__value van-field__value"},{default:c((()=>[h(s,{class:"van-field__body"},{default:c((()=>[h(C,{type:"text",id:"van-field-7-input",modelValue:n.formData.code,"onUpdate:modelValue":e[1]||(e[1]=a=>n.formData.code=a),name:"username",class:"van-field__control",placeholder:"请填写验证码","aria-labelledby":"van-field-7-label"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),h(s,{class:"padding"},{default:c((()=>[h(I,{type:"submit",class:"van-button van-button--primary van-button--normal van-button--block",onClick:o.phoneLogin,disabled:n.login_loading},{default:c((()=>[r("div",{class:"van-button__content"},[r("span",{class:"van-button__text"},"立即绑定")])])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1}),n.showModal?(u(),i(s,{key:0,class:"custom-modal"},{default:c((()=>[h(s,{class:"modal-mask",onClick:o.closeModal},null,8,["onClick"]),h(s,{class:"modal-container"},{default:c((()=>[h(s,{class:"modal-header"},{default:c((()=>[h(x,{class:"modal-title"},{default:c((()=>[p("温馨提示")])),_:1})])),_:1}),h(s,{class:"modal-content"},{default:c((()=>[h(x,{class:"modal-text"},{default:c((()=>[p("尊敬的会员您好，微信首次登录需绑定手机号码作为主账号，请您务必完成绑定。")])),_:1})])),_:1}),h(s,{class:"modal-footer"},{default:c((()=>[h(I,{class:"confirm-btn",onClick:o.closeModal},{default:c((()=>[p("确定")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):m("",!0),r("div",{id:"captcha-element"})])),_:1})}],["__scopeId","data-v-045a66e6"]]);export{k as default};
