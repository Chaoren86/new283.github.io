import{_ as e,l as t,k as a,m as n,s as l,N as i,H as o,K as s,a as c,w as d,j as r,o as u,b as h,f as p,x as g,e as _,g as f,y as v,i as m,E as b,I as w,D,L as x}from"./index-BrfRr25j.js";import{$ as y}from"./request.BcI2bJcs.js";import{_ as k}from"./goBack-icon.Dnnb51to.js";const I=e({data:()=>({openRegister:!1,openLogin:!1,isPhone:!0,loginData:{account:null,password:null},registerData:{account:null,phone:null,code:null,password:null,password2:null},formData:{phone:null,code:null},wxData:{openid:null,nickname:null,headimgurl:null,agent_code:null},count:null,timer:null,agent_code:t("agent_code")||"",login_loading:!1,captcha:null,captchaButton:null,isWechatBrowser:!0,openPhone:!1,config:null,isPhone2:!0}),onLoad(e){this.getConfig(),e.openid&&(this.wxData.openid=e.openid,this.wxData.nickname=e.nickname,this.wxData.headimgurl=e.headimgurl,this.loginWithWechat())},mounted(){this.isWechatBrowser=this.checkIsWechatBrowser(),this.captchaButton=document.getElementById("captcha-button"),window.initAliyunCaptcha({SceneId:"bv3tympas",prefix:"14sny91",mode:"popup",element:"#captcha-element",button:"#captcha-button",captchaVerifyCallback:this.captchaVerifyCallback,onBizResultCallback:this.onBizResultCallback,getInstance:this.getInstance,slideStyle:{width:360,height:40},language:"cn"})},beforeUnmount(){var e,t;this.captchaButton=null,null==(e=document.getElementById("aliyunCaptcha-mask"))||e.remove(),null==(t=document.getElementById("aliyunCaptcha-window-popup"))||t.remove()},methods:{checkPhone(){this.formData.phone&&this.formData.phone.length>11&&(this.formData.phone=this.formData.phone.substring(0,11)),this.isMobile(this.formData.phone)?this.isPhone=!1:this.isPhone=!0},checkPhone2(){this.registerData.phone&&this.registerData.phone.length>11&&(this.registerData.phone=this.registerData.phone.substring(0,11)),this.isMobile(this.registerData.phone)?this.isPhone2=!1:this.isPhone2=!0},toLogin(){a({url:"/pages/login/login?is_login=1"})},toRegister(){this.openRegister=!0,this.openLogin=!1,this.openPhone=!1},toPhoneLogin(){this.openPhone=!0,this.openLogin=!1,this.openRegister=!1},accountLogin(){if(!this.loginData.account||!this.loginData.password)return n({title:"账号和密码不能为空",duration:1e3,icon:"none"});this.login_loading=!0,y.post("/app_user_account_login",{account:this.loginData.account,password:this.loginData.password,agent_code:this.agent_code}).then((e=>{this.login_loading=!1,200==e.code?(l("UserInfo",e.data),n({title:e.msg,icon:"success"}),setTimeout((()=>{i({url:"/pages/index/index"})}),1e3)):n({title:e.msg,icon:"none"})})).catch((e=>{this.login_loading=!1,n({title:"登录失败，请重试",icon:"none"})}))},isValidAccount:e=>/^[a-zA-Z0-9]+$/.test(e),register(){return this.registerData.account&&this.registerData.phone&&this.registerData.code&&this.registerData.password&&this.registerData.password2?this.isValidAccount(this.registerData.account)?this.isMobile(this.registerData.phone)?this.registerData.password!==this.registerData.password2?n({title:"两次密码输入不一致",duration:1e3,icon:"none"}):(this.login_loading=!0,void y.post("/app_user_register",{account:this.registerData.account,phone:this.registerData.phone,code:this.registerData.code,password:this.registerData.password,agent_code:this.agent_code}).then((e=>{if(this.login_loading=!1,200==e.code)return l("UserInfo",e.data),n({title:e.msg,duration:1e3,icon:"none"}),i({url:"/pages/index/index"});n({title:e.msg,icon:"none"})})).catch((e=>{this.login_loading=!1,n({title:"注册失败，请重试",icon:"none"})}))):n({title:"手机号码格式错误",duration:1e3,icon:"none"}):n({title:"账号只能包含字母和数字",duration:1e3,icon:"none"}):n({title:"请填写完整信息",duration:1e3,icon:"none"})},oneKeyPhoneLogin(){this.openPhone=!0},getConfig(){y.post("/app_user_get_config").then((e=>{var t,a,n,l;200==e.code&&(this.config=e.data,console.log(null==(t=this.config)?void 0:t.wx_login_open,"wx_login_open"),this.openLogin=!0,this.openPhone=!1,this.openRegister=!1,this.isWechatBrowser&&1==(null==(a=this.config)?void 0:a.wx_login_open)&&(this.openLogin=!1,this.openPhone=!1),this.isWechatBrowser&&0!=(null==(n=this.config)?void 0:n.wx_login_open)||(this.openPhone=!0,this.openLogin=!1),this.isWechatBrowser&&1!=(null==(l=this.config)?void 0:l.paw_login_open)||(this.openPhone=!1,this.openLogin=!0))}))},checkIsWechatBrowser:()=>navigator.userAgent.toLowerCase().includes("micromessenger"),wechatLogin(){if(this.config.app_weixing_url){const e=encodeURIComponent(`${window.location.origin}/#/pages/login/login`);window.location.href=this.config.app_weixing_url+`/wx_go.php?action=get_code&backurl=${e}`}else n({title:"未配置微信授权接口，请联系管理员",icon:"error"})},async loginWithWechat(){o({title:"登录中..."});try{this.wxData.agent_code=this.agent_code;const e=await y.post("/app_user_weixin_login",this.wxData);s(),200==e.code?(l("UserInfo",e.data),n({title:e.msg,icon:"success"}),e.data.phone?setTimeout((()=>{i({url:"/pages/index/index"})}),1e3):i({url:"/pages/my/mobile"})):n({title:e.msg,icon:"none"})}catch(e){s(),n({title:"登录失败，请重试",icon:"none"})}},async captchaVerifyCallback(e){const t=await y.post("/aliyunVerify",{captchaVerifyParam:e,phone:this.registerData.phone});return 200==t.code&&"T001"==t.data?{captchaResult:!0,bizResult:!0}:n({title:t.msg,duration:1e3,icon:"none"})},onBizResultCallback(e){e&&this.getPhoneCode()},popup(e){this.popupId=e,this.captchaButton.click()},getPhoneCode(){this.timer||(this.showCode=!0,this.count=60,this.timer=setInterval((()=>{this.count>0&&this.count<=60?this.count--:(this.showCode=!1,clearInterval(this.timer),this.timer=null)}),1e3))},getMessage(){if(!this.isMobile(this.formData.phone))return n({title:"手机号码输入有误",duration:1e3,icon:"none",position:"top"});o({mask:!0}),y.post("/app_user_get_message",{phone:this.formData.phone,type:"sign"}).then((e=>(s(),200==e.code&&"短信发送成功"==e.msg?(this.getPhoneCode(),n({title:e.msg,duration:3e3,icon:"none",position:"top"})):n({title:e.msg,duration:1e3,icon:"none",position:"top"}))))},isMobile:e=>/^1[3-9]\d{9}$/.test(e),routerIndex(){i({url:"/pages/index/index"})},toIm(){i({url:"/pages/im/imdetails"})},phoneLogin(){for(let e in this.formData)if(!this.formData[e])return n({title:"手机号或验证码不能为空",duration:1e3,icon:"none"});if(this.login_loading=!0,!this.isMobile(this.formData.phone))return this.login_loading=!1,n({title:"手机号码有误",duration:1e3,icon:"none"});y.post("/app_user_phone_login",{type:"login",phone:this.formData.phone,code:this.formData.code,agent_code:this.agent_code}).then((e=>200==e.code?(this.show=!0,this.UserInfo=e.data,l("UserInfo",e.data),n({title:e.msg,duration:1e3,icon:"none"}),i({url:"/pages/index/index"})):(this.login_loading=!1,n({title:e.msg,duration:1e3,icon:"none"}))))}}},[["render",function(e,t,a,n,l,i){const o=v,s=r,y=m,I=b,P=w,C=D,V=x;return u(),c(s,{class:"login"},{default:d((()=>[h(s,{class:"foot-action head-fixed child-view"},{default:d((()=>[h(s,{class:"w-750 title",style:{position:"fixed",top:"0",left:"0","z-index":"999"}},{default:d((()=>[h(s,{class:"h-100 w-row-justify-between-align"},{default:d((()=>[h(s,{class:"wh-80 w-row-center",onClick:t[0]||(t[0]=e=>i.routerIndex())},{default:d((()=>[h(o,{class:"wh-40",src:k})])),_:1}),h(s,{class:"w-350 h-100 w-row-center w-wz-conts font-36"},{default:d((()=>[h(y,null,{default:d((()=>[p("账号注册")])),_:1})])),_:1}),h(s,{class:"wh-80 w-row-center"})])),_:1})])),_:1}),h(s,{class:"bwh-120"}),h(s,{class:"cover-tw index-bg absolute-default fixed"}),h(s,{class:"content-box padding-top-xs",style:{"margin-top":"50rpx"}},{default:d((()=>[h(s,{class:"text-lg text-bold text-color-black",style:{padding:"0 60rpx",display:"flex","justify-content":"space-between","align-items":"center"}},{default:d((()=>[p("账密注册 "),g("span",{onClick:t[1]||(t[1]=e=>i.toLogin()),class:"goRegister"},"去登录")])),_:1}),h(V,{class:"van-form login"},{default:d((()=>[h(s,{class:"van-cell-group van-cell-group--inset"},{default:d((()=>[h(s,{class:"van-cell van-field van-field--label-top"},{default:d((()=>[h(s,{class:"van-cell__title van-field__label van-field__label--top"},{default:d((()=>[h(I,{for:"van-field-7-input"},{default:d((()=>[p("账号名")])),_:1})])),_:1}),h(s,{class:"van-cell__value van-field__value"},{default:d((()=>[h(s,{class:"van-field__body"},{default:d((()=>[h(P,{type:"text",id:"van-field-7-input",modelValue:l.registerData.account,"onUpdate:modelValue":t[2]||(t[2]=e=>l.registerData.account=e),name:"username",class:"van-field__control",placeholder:"请输入账号名","aria-labelledby":"van-field-7-label"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),h(s,{class:"van-cell-group van-cell-group--inset"},{default:d((()=>[h(s,{class:"van-cell van-field van-field--label-top"},{default:d((()=>[h(s,{class:"van-cell__title van-field__label van-field__label--top"},{default:d((()=>[h(I,{for:"van-field-7-input"},{default:d((()=>[p("手机号")])),_:1})])),_:1}),h(s,{class:"van-cell__value van-field__value"},{default:d((()=>[h(s,{class:"van-field__body"},{default:d((()=>[h(P,{type:"text",id:"van-field-7-input",modelValue:l.registerData.phone,"onUpdate:modelValue":t[3]||(t[3]=e=>l.registerData.phone=e),name:"username",class:"van-field__control",placeholder:"请填写手机号","aria-labelledby":"van-field-7-label",maxlength:11,onInput:i.checkPhone2},null,8,["modelValue","onInput"]),h(s,{class:"van-field__button"},{default:d((()=>[h(C,{type:"button",class:"van-button van-button--warning van-button--small",disabled:l.isPhone2,id:"captcha-button"},{default:d((()=>[g("div",{class:"van-button__content"},[l.count?(u(),_("span",{key:0,class:"van-button__text"},"重新获取"+f(l.count<10?"0"+l.count:l.count)+"秒",1)):(u(),_("span",{key:1,class:"van-button__text"},"发送验证码"))])])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),h(s,{class:"van-cell-group van-cell-group--inset"},{default:d((()=>[h(s,{class:"van-cell van-field van-field--label-top"},{default:d((()=>[h(s,{class:"van-cell__title van-field__label van-field__label--top"},{default:d((()=>[h(I,{for:"van-field-7-input"},{default:d((()=>[p("短信验证码")])),_:1})])),_:1}),h(s,{class:"van-cell__value van-field__value"},{default:d((()=>[h(s,{class:"van-field__body"},{default:d((()=>[h(P,{type:"text",id:"van-field-7-input",modelValue:l.registerData.code,"onUpdate:modelValue":t[4]||(t[4]=e=>l.registerData.code=e),name:"username",class:"van-field__control",placeholder:"请填写短信验证码","aria-labelledby":"van-field-7-label"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),h(s,{class:"van-cell-group van-cell-group--inset"},{default:d((()=>[h(s,{class:"van-cell van-field van-field--label-top"},{default:d((()=>[h(s,{class:"van-cell__title van-field__label van-field__label--top"},{default:d((()=>[h(I,{for:"van-field-7-input"},{default:d((()=>[p("登录密码")])),_:1})])),_:1}),h(s,{class:"van-cell__value van-field__value"},{default:d((()=>[h(s,{class:"van-field__body"},{default:d((()=>[h(P,{type:"password",id:"van-field-7-input",modelValue:l.registerData.password,"onUpdate:modelValue":t[5]||(t[5]=e=>l.registerData.password=e),name:"username",class:"van-field__control",placeholder:"请输入登录密码","aria-labelledby":"van-field-7-label"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),h(s,{class:"van-cell-group van-cell-group--inset"},{default:d((()=>[h(s,{class:"van-cell van-field van-field--label-top"},{default:d((()=>[h(s,{class:"van-cell__title van-field__label van-field__label--top"},{default:d((()=>[h(I,{for:"van-field-7-input"},{default:d((()=>[p("确认密码")])),_:1})])),_:1}),h(s,{class:"van-cell__value van-field__value"},{default:d((()=>[h(s,{class:"van-field__body"},{default:d((()=>[h(P,{type:"password",id:"van-field-7-input",modelValue:l.registerData.password2,"onUpdate:modelValue":t[6]||(t[6]=e=>l.registerData.password2=e),name:"username",class:"van-field__control",placeholder:"再次请输入登录密码","aria-labelledby":"van-field-7-label"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),h(s,{class:"padding"},{default:d((()=>[h(C,{type:"submit",class:"van-button van-button--primary van-button--normal van-button--block",onClick:i.register,disabled:l.login_loading},{default:d((()=>[g("div",{class:"van-button__content"},[g("span",{class:"van-button__text"},"立即注册")])])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1}),g("div",{id:"captcha-element"})])),_:1})}],["__scopeId","data-v-cdeb58fa"]]);export{I as default};
